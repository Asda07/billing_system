{% extends "base.html" %}

{% block title %}Invoice - Order #{{ order.code }}{% endblock %}

{% block content %}
<h2>Invoice - Order #{{ order.code }}</h2>

<div class="mb-20">
    <p><strong>Order Code:</strong> {{ order.code }}</p>
    <p><strong>Customer Email:</strong> {{ order.customer_email }}</p>
    <p><strong>Purchase Date:</strong> {{ order.purchase_date|date:"d-m-Y H:i" }}</p>
</div>

<!-- Items Table -->
<h3>Bill Details</h3>
<table>
    <thead>
        <tr>
            <th class="text-center" style="width: 5%;">S.No</th>
            <th class="text-center" style="width: 12%;">Product ID</th>
            <th class="text-center" style="width: 12%;">Unit Price</th>
            <th class="text-center" style="width: 8%;">Qty</th>
            <th class="text-center" style="width: 15%;">Purchase Price</th>
            <th class="text-center" style="width: 8%;">Tax %</th>
            <th class="text-center" style="width: 15%;">Tax Amount</th>
            <th class="text-center" style="width: 15%;">Total Price</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td class="text-center">{{ forloop.counter }}</td>
            <td class="text-center">{{ item.product.code }}</td>
            <td class="text-right">{{ item.unit_price }}</td>
            <td class="text-center">{{ item.quantity }}</td>
            <td class="text-right">{{ item.subtotal }}</td>
            <td class="text-center">{{ item.tax_percentage }}%</td>
            <td class="text-right">{{ item.tax_amount }}</td>
            <td class="text-right">{{ item.total }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Summary -->
<h3>Summary</h3>
<table style="width: 50%;">
    <tr>
        <td><strong>Total Price (without tax)</strong></td>
        <td class="text-right">{{ order.total_before_tax }}</td>
    </tr>
    <tr>
        <td><strong>Total Tax Payable</strong></td>
        <td class="text-right">{{ order.total_tax }}</td>
    </tr>
    <tr>
        <td><strong>Net Price (Rounded Down)</strong></td>
        <td class="text-right">{{ order.total_amount }}</td>
    </tr>
    <tr>
        <td><strong>Amount Paid</strong></td>
        <td class="text-right">{{ order.amount_paid }}</td>
    </tr>
    <tr style="background: #f2f2f2;">
        <td><strong>Balance to Customer</strong></td>
        <td class="text-right" style="font-weight: bold;">{{ order.change_given }}</td>
    </tr>
</table>

<!-- Change Denomination Breakdown -->
{% if change_details %}
<h3>Balance Denomination Breakdown</h3>
<table style="width: 35%;">
    <thead>
        <tr>
            <th class="text-center">Denomination</th>
            <th class="text-center">Count</th>
            <th class="text-center">Amount</th>
        </tr>
    </thead>
    <tbody>
        {% for detail in change_details %}
        <tr>
            <td class="text-center">{{ detail.denomination.value }}</td>
            <td class="text-center">{{ detail.count }}</td>
            <td class="text-right">{{ detail.get_total_value }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<div class="mt-20">
    <a href="{% url 'billing-form' %}" class="btn btn-primary">New Bill</a>
</div>
{% endblock %}
